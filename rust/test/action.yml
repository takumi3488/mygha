name: 'Run Tests'
description: 'Run Rust tests for the issue-picker project'

inputs:
  skipTest:
    description: 'Skip test execution if set to true'
    required: false
    default: 'false'

runs:
  using: 'composite'
  steps:
    - name: Install taplo
      shell: bash
      run: |
        if ! command -v taplo &> /dev/null; then
          curl -fsSL https://github.com/tamasfe/taplo/releases/latest/download/taplo-linux-x86_64.gz \
            | gzip -d - | install -m 755 /dev/stdin /usr/local/bin/taplo
        fi

    - name: Lint Cargo.toml
      shell: bash
      run: taplo lint Cargo.toml

    - name: Validate Cargo.toml
      shell: bash
      run: taplo check Cargo.toml

    - name: Check Cargo.toml formatting
      shell: bash
      run: taplo fmt --check --option reorder_keys=true Cargo.toml

    - name: Run cargo check
      shell: bash
      run: cargo check --all-features
      
    - name: Run tests
      if: inputs.skipTest != 'true'
      shell: bash
      run: cargo test --all-features
      
    - name: Run clippy
      shell: bash
      run: cargo clippy --all-features -- -D warnings
      
    - name: Check formatting
      shell: bash
      run: cargo fmt -- --check
